---
import Config from '../../layouts/Config.astro';
---

<Config title="Finnovest | Drawr Flow">
  <!-- Hub layer (underneath) -->
  <div class="hub">
    <!-- Tab panels -->
    <div class="tab-panel active" data-tab="trades">
      <div class="panel-header">
        <h2>Trades</h2>
      </div>
      <div class="panel-content">
        <div class="skeleton-list">
          <div class="skeleton-item">
            <div class="skeleton-avatar"></div>
            <div class="skeleton-text">
              <div class="skeleton-line w-40"></div>
              <div class="skeleton-line w-60"></div>
            </div>
            <div class="skeleton-amount"></div>
          </div>
          <div class="skeleton-item">
            <div class="skeleton-avatar"></div>
            <div class="skeleton-text">
              <div class="skeleton-line w-50"></div>
              <div class="skeleton-line w-40"></div>
            </div>
            <div class="skeleton-amount"></div>
          </div>
          <div class="skeleton-item">
            <div class="skeleton-avatar"></div>
            <div class="skeleton-text">
              <div class="skeleton-line w-60"></div>
              <div class="skeleton-line w-30"></div>
            </div>
            <div class="skeleton-amount"></div>
          </div>
          <div class="skeleton-item">
            <div class="skeleton-avatar"></div>
            <div class="skeleton-text">
              <div class="skeleton-line w-45"></div>
              <div class="skeleton-line w-55"></div>
            </div>
            <div class="skeleton-amount"></div>
          </div>
          <div class="skeleton-item">
            <div class="skeleton-avatar"></div>
            <div class="skeleton-text">
              <div class="skeleton-line w-35"></div>
              <div class="skeleton-line w-50"></div>
            </div>
            <div class="skeleton-amount"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="tab-panel" data-tab="holdings">
      <div class="panel-header">
        <h2>Holdings</h2>
      </div>
      <div class="panel-content">
        <div class="skeleton-grid">
          <div class="skeleton-card">
            <div class="skeleton-card-icon"></div>
            <div class="skeleton-line w-60"></div>
            <div class="skeleton-line w-40"></div>
          </div>
          <div class="skeleton-card">
            <div class="skeleton-card-icon"></div>
            <div class="skeleton-line w-50"></div>
            <div class="skeleton-line w-55"></div>
          </div>
          <div class="skeleton-card">
            <div class="skeleton-card-icon"></div>
            <div class="skeleton-line w-45"></div>
            <div class="skeleton-line w-60"></div>
          </div>
          <div class="skeleton-card">
            <div class="skeleton-card-icon"></div>
            <div class="skeleton-line w-55"></div>
            <div class="skeleton-line w-35"></div>
          </div>
          <div class="skeleton-card">
            <div class="skeleton-card-icon"></div>
            <div class="skeleton-line w-40"></div>
            <div class="skeleton-line w-50"></div>
          </div>
          <div class="skeleton-card">
            <div class="skeleton-card-icon"></div>
            <div class="skeleton-line w-60"></div>
            <div class="skeleton-line w-45"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="tab-panel" data-tab="ai">
      <div class="panel-header">
        <h2>AI Assistant</h2>
      </div>
      <div class="panel-content">
        <div class="skeleton-chat">
          <div class="skeleton-message incoming">
            <div class="skeleton-bubble">
              <div class="skeleton-line w-80"></div>
              <div class="skeleton-line w-60"></div>
            </div>
          </div>
          <div class="skeleton-message outgoing">
            <div class="skeleton-bubble">
              <div class="skeleton-line w-50"></div>
            </div>
          </div>
          <div class="skeleton-message incoming">
            <div class="skeleton-bubble">
              <div class="skeleton-line w-90"></div>
              <div class="skeleton-line w-70"></div>
              <div class="skeleton-line w-40"></div>
            </div>
          </div>
          <div class="skeleton-message outgoing">
            <div class="skeleton-bubble">
              <div class="skeleton-line w-60"></div>
              <div class="skeleton-line w-30"></div>
            </div>
          </div>
        </div>
        <div class="skeleton-input-bar">
          <div class="skeleton-input"></div>
          <div class="skeleton-send"></div>
        </div>
      </div>
    </div>

    <div class="tab-panel" data-tab="search">
      <div class="panel-header">
        <h2>Search</h2>
      </div>
      <div class="panel-content">
        <div class="skeleton-search-bar"></div>
        <div class="skeleton-list">
          <div class="skeleton-item">
            <div class="skeleton-avatar"></div>
            <div class="skeleton-text">
              <div class="skeleton-line w-70"></div>
              <div class="skeleton-line w-40"></div>
            </div>
          </div>
          <div class="skeleton-item">
            <div class="skeleton-avatar"></div>
            <div class="skeleton-text">
              <div class="skeleton-line w-50"></div>
              <div class="skeleton-line w-60"></div>
            </div>
          </div>
          <div class="skeleton-item">
            <div class="skeleton-avatar"></div>
            <div class="skeleton-text">
              <div class="skeleton-line w-65"></div>
              <div class="skeleton-line w-35"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Tab bar -->
    <div class="tab-bar">
      <button class="tab-icon active" data-tab="trades">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <rect x="4" y="4" width="16" height="16" rx="2"/>
        </svg>
      </button>
      <button class="tab-icon" data-tab="holdings">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <polygon points="12,3 22,21 2,21"/>
        </svg>
      </button>
      <button class="tab-icon" data-tab="ai">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <polygon points="12,2 22,12 12,22 2,12"/>
        </svg>
      </button>
      <button class="tab-icon" data-tab="search">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <circle cx="12" cy="12" r="9"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Curtain layer (on top, draggable) -->
  <div class="curtain" id="curtain">
    <!-- Top bar -->
    <div class="top-bar">
      <div class="firm-logo"></div>
      <div class="portfolio-selector">
        <span class="portfolio-selector-text">Main Portfolio</span>
        <svg class="portfolio-selector-icon" viewBox="0 0 16 16" fill="none">
          <path d="M4 6l4 4 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="user-avatar"></div>
    </div>

    <!-- Drag handle -->
    <div class="drag-handle" id="dragHandle">
      <div class="handle-bar"></div>
    </div>

    <!-- Scrollable content -->
    <div class="curtain-content">
      <!-- Portfolio value -->
      <div class="skeleton-portfolio-value">
        <div class="skeleton-line w-30"></div>
        <div class="skeleton-value"></div>
        <div class="skeleton-change"></div>
      </div>

      <!-- Skeleton cards -->
      <div class="skeleton-section-label"></div>
      <div class="skeleton-card-stack">
        <div class="skeleton-recommendation-card">
          <div class="skeleton-badge"></div>
          <div class="skeleton-ticker-row">
            <div class="skeleton-ticker-logo"></div>
            <div class="skeleton-ticker-info">
              <div class="skeleton-line w-40"></div>
              <div class="skeleton-line w-60"></div>
            </div>
            <div class="skeleton-amount"></div>
          </div>
          <div class="skeleton-line w-90"></div>
          <div class="skeleton-line w-70"></div>
          <div class="skeleton-button"></div>
        </div>

        <div class="skeleton-recommendation-card offset-1">
          <div class="skeleton-badge"></div>
          <div class="skeleton-ticker-row">
            <div class="skeleton-ticker-logo"></div>
            <div class="skeleton-ticker-info">
              <div class="skeleton-line w-50"></div>
              <div class="skeleton-line w-40"></div>
            </div>
            <div class="skeleton-amount"></div>
          </div>
        </div>

        <div class="skeleton-recommendation-card offset-2">
          <div class="skeleton-badge"></div>
          <div class="skeleton-ticker-row">
            <div class="skeleton-ticker-logo"></div>
            <div class="skeleton-ticker-info">
              <div class="skeleton-line w-45"></div>
              <div class="skeleton-line w-55"></div>
            </div>
            <div class="skeleton-amount"></div>
          </div>
        </div>
      </div>

      <!-- Performance section -->
      <div class="skeleton-section-label mt-24"></div>
      <div class="skeleton-chart"></div>

      <!-- Allocation section -->
      <div class="skeleton-section-label mt-24"></div>
      <div class="skeleton-allocation">
        <div class="skeleton-allocation-bar"></div>
        <div class="skeleton-allocation-legend">
          <div class="skeleton-legend-item">
            <div class="skeleton-legend-dot"></div>
            <div class="skeleton-line w-40"></div>
          </div>
          <div class="skeleton-legend-item">
            <div class="skeleton-legend-dot"></div>
            <div class="skeleton-line w-35"></div>
          </div>
          <div class="skeleton-legend-item">
            <div class="skeleton-legend-dot"></div>
            <div class="skeleton-line w-45"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</Config>

<style>
  /* ═══════════════════════════════════════════════════════════════════════════
     LAYOUT
     ═══════════════════════════════════════════════════════════════════════════ */

  .hub {
    position: absolute;
    inset: 0;
    background: #000;
    display: flex;
    flex-direction: column;
    padding-top: 60px;
    z-index: 1;
  }

  .curtain {
    position: absolute;
    inset: 0;
    background: var(--base-11);
    border-radius: 0 0 var(--radius-xl) var(--radius-xl);
    z-index: 2;
    display: flex;
    flex-direction: column;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
    will-change: transform;
  }

  /* ═══════════════════════════════════════════════════════════════════════════
     TOP BAR
     ═══════════════════════════════════════════════════════════════════════════ */

  .top-bar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 56px 20px 12px;
    flex-shrink: 0;
  }

  .firm-logo {
    width: 32px;
    height: 32px;
    background: var(--base-8);
    border-radius: 8px;
  }

  .portfolio-selector {
    display: flex;
    align-items: center;
    gap: 6px;
    color: var(--base-1);
  }

  .portfolio-selector-text {
    font-size: 15px;
    font-weight: 600;
  }

  .portfolio-selector-icon {
    width: 16px;
    height: 16px;
  }

  .user-avatar {
    width: 32px;
    height: 32px;
    background: var(--base-8);
    border-radius: 50%;
  }

  /* ═══════════════════════════════════════════════════════════════════════════
     DRAG HANDLE
     ═══════════════════════════════════════════════════════════════════════════ */

  .drag-handle {
    display: flex;
    justify-content: center;
    padding: 8px 0 16px;
    cursor: grab;
    flex-shrink: 0;
  }

  .drag-handle:active {
    cursor: grabbing;
  }

  .handle-bar {
    width: 36px;
    height: 5px;
    background: var(--base-7);
    border-radius: 3px;
    transition: background 0.2s;
  }

  .drag-handle:hover .handle-bar {
    background: var(--base-6);
  }

  /* ═══════════════════════════════════════════════════════════════════════════
     CURTAIN CONTENT
     ═══════════════════════════════════════════════════════════════════════════ */

  .curtain-content {
    flex: 1;
    overflow-y: auto;
    padding: 0 20px 40px;
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  .curtain-content::-webkit-scrollbar {
    display: none;
  }

  /* ═══════════════════════════════════════════════════════════════════════════
     HUB TABS
     ═══════════════════════════════════════════════════════════════════════════ */

  .tab-panel {
    display: none;
    flex: 1;
    flex-direction: column;
    overflow: hidden;
  }

  .tab-panel.active {
    display: flex;
  }

  .panel-header {
    padding: 0 20px 16px;
    flex-shrink: 0;
  }

  .panel-header h2 {
    font-size: 28px;
    font-weight: 700;
    color: var(--base-1);
  }

  .panel-content {
    flex: 1;
    overflow-y: auto;
    padding: 0 20px;
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  .panel-content::-webkit-scrollbar {
    display: none;
  }

  .tab-bar {
    display: flex;
    justify-content: space-around;
    padding: 16px 20px 32px;
    background: #000;
    flex-shrink: 0;
  }

  .tab-icon {
    width: 44px;
    height: 44px;
    border: none;
    background: transparent;
    color: var(--base-6);
    cursor: pointer;
    padding: 10px;
    border-radius: 12px;
    transition: all 0.2s;
  }

  .tab-icon:hover {
    background: var(--base-10);
    color: var(--base-4);
  }

  .tab-icon.active {
    color: var(--base-1);
  }

  .tab-icon svg {
    width: 100%;
    height: 100%;
  }

  /* ═══════════════════════════════════════════════════════════════════════════
     SKELETON STYLES
     ═══════════════════════════════════════════════════════════════════════════ */

  .skeleton-line {
    height: 12px;
    background: var(--base-9);
    border-radius: 6px;
  }

  .skeleton-line.w-30 { width: 30%; }
  .skeleton-line.w-35 { width: 35%; }
  .skeleton-line.w-40 { width: 40%; }
  .skeleton-line.w-45 { width: 45%; }
  .skeleton-line.w-50 { width: 50%; }
  .skeleton-line.w-55 { width: 55%; }
  .skeleton-line.w-60 { width: 60%; }
  .skeleton-line.w-65 { width: 65%; }
  .skeleton-line.w-70 { width: 70%; }
  .skeleton-line.w-80 { width: 80%; }
  .skeleton-line.w-90 { width: 90%; }

  /* Skeleton list */
  .skeleton-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .skeleton-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    background: var(--base-10);
    border-radius: var(--radius-md);
  }

  .skeleton-avatar {
    width: 40px;
    height: 40px;
    background: var(--base-9);
    border-radius: 50%;
    flex-shrink: 0;
  }

  .skeleton-text {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .skeleton-amount {
    width: 60px;
    height: 16px;
    background: var(--base-9);
    border-radius: 8px;
  }

  /* Skeleton grid (holdings) */
  .skeleton-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
  }

  .skeleton-card {
    padding: 16px;
    background: var(--base-10);
    border-radius: var(--radius-md);
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .skeleton-card-icon {
    width: 36px;
    height: 36px;
    background: var(--base-9);
    border-radius: 10px;
    margin-bottom: 4px;
  }

  /* Skeleton chat (AI) */
  .skeleton-chat {
    display: flex;
    flex-direction: column;
    gap: 16px;
    flex: 1;
    padding-bottom: 16px;
  }

  .skeleton-message {
    display: flex;
  }

  .skeleton-message.outgoing {
    justify-content: flex-end;
  }

  .skeleton-bubble {
    max-width: 75%;
    padding: 12px 16px;
    border-radius: 16px;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .skeleton-message.incoming .skeleton-bubble {
    background: var(--base-10);
  }

  .skeleton-message.outgoing .skeleton-bubble {
    background: var(--brand-10);
  }

  .skeleton-input-bar {
    display: flex;
    gap: 12px;
    padding-top: 16px;
    border-top: 1px solid var(--base-10);
    margin-top: auto;
  }

  .skeleton-input {
    flex: 1;
    height: 44px;
    background: var(--base-10);
    border-radius: 22px;
  }

  .skeleton-send {
    width: 44px;
    height: 44px;
    background: var(--brand-8);
    border-radius: 50%;
  }

  /* Skeleton search */
  .skeleton-search-bar {
    height: 44px;
    background: var(--base-10);
    border-radius: 22px;
    margin-bottom: 20px;
  }

  /* Curtain skeletons */
  .skeleton-portfolio-value {
    text-align: center;
    padding: 8px 0 24px;
  }

  .skeleton-portfolio-value .skeleton-line {
    margin: 0 auto 8px;
  }

  .skeleton-value {
    width: 160px;
    height: 36px;
    background: var(--base-9);
    border-radius: 18px;
    margin: 0 auto 8px;
  }

  .skeleton-change {
    width: 80px;
    height: 20px;
    background: var(--base-9);
    border-radius: 10px;
    margin: 0 auto;
  }

  .skeleton-section-label {
    width: 100px;
    height: 14px;
    background: var(--base-9);
    border-radius: 7px;
    margin-bottom: 16px;
  }

  .mt-24 {
    margin-top: 24px;
  }

  /* Recommendation cards */
  .skeleton-card-stack {
    position: relative;
    height: 200px;
    margin-bottom: 24px;
  }

  .skeleton-recommendation-card {
    position: absolute;
    left: 0;
    right: 0;
    padding: 16px;
    background: var(--base-10);
    border-radius: var(--radius-lg);
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .skeleton-recommendation-card.offset-1 {
    top: 8px;
    transform: scale(0.96);
    opacity: 0.7;
    z-index: -1;
  }

  .skeleton-recommendation-card.offset-2 {
    top: 16px;
    transform: scale(0.92);
    opacity: 0.5;
    z-index: -2;
  }

  .skeleton-badge {
    width: 48px;
    height: 22px;
    background: var(--base-9);
    border-radius: 11px;
  }

  .skeleton-ticker-row {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .skeleton-ticker-logo {
    width: 40px;
    height: 40px;
    background: var(--base-9);
    border-radius: 12px;
  }

  .skeleton-ticker-info {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .skeleton-button {
    height: 44px;
    background: var(--base-9);
    border-radius: 22px;
    margin-top: 4px;
  }

  /* Chart skeleton */
  .skeleton-chart {
    height: 160px;
    background: var(--base-10);
    border-radius: var(--radius-lg);
  }

  /* Allocation skeleton */
  .skeleton-allocation {
    padding: 16px;
    background: var(--base-10);
    border-radius: var(--radius-lg);
  }

  .skeleton-allocation-bar {
    height: 12px;
    background: var(--base-9);
    border-radius: 6px;
    margin-bottom: 16px;
  }

  .skeleton-allocation-legend {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .skeleton-legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .skeleton-legend-dot {
    width: 12px;
    height: 12px;
    background: var(--base-9);
    border-radius: 50%;
  }
</style>

<!-- GSAP CDN -->
<script is:inline src="https://cdn.jsdelivr.net/npm/gsap@3.12/dist/gsap.min.js"></script>
<script is:inline src="https://cdn.jsdelivr.net/npm/gsap@3.12/dist/Draggable.min.js"></script>
<script is:inline src="https://cdn.jsdelivr.net/npm/gsap@3.12/dist/InertiaPlugin.min.js"></script>

<script is:inline>
  document.addEventListener('DOMContentLoaded', () => {
    // ═══════════════════════════════════════════════════════════════════════════
    // CURTAIN DRAG SETUP
    // ═══════════════════════════════════════════════════════════════════════════

    const curtain = document.getElementById('curtain');
    const handle = document.getElementById('dragHandle');
    const screenHeight = 822; // iPhone screen height minus some padding
    const peekHeight = 100;   // Height of collapsed header
    const maxY = screenHeight - peekHeight;

    let isOpen = false;

    // Register GSAP plugins
    gsap.registerPlugin(Draggable, InertiaPlugin);

    // Create draggable instance
    const draggable = Draggable.create(curtain, {
      type: 'y',
      bounds: { minY: 0, maxY: maxY },
      inertia: true,
      snap: {
        y: (value) => {
          // Snap to nearest position
          const threshold = maxY * 0.3;
          if (value > threshold) {
            return maxY;
          }
          return 0;
        }
      },
      onDragStart: function() {
        curtain.style.transition = 'none';
      },
      onThrowComplete: function() {
        isOpen = this.y > maxY / 2;
        updateCurtainState();
      },
      onDrag: function() {
        updateCurtainOpacity(this.y);
      }
    })[0];

    // Update visual state based on position
    function updateCurtainOpacity(y) {
      const progress = y / maxY;
      // Could add visual feedback here (e.g., shadow intensity)
    }

    function updateCurtainState() {
      // Add any state-based updates here
    }

    // Handle tap toggle
    handle.addEventListener('click', (e) => {
      // Only toggle if not dragging
      if (draggable.isDragging) return;

      isOpen = !isOpen;
      gsap.to(curtain, {
        y: isOpen ? maxY : 0,
        duration: 0.5,
        ease: 'power3.out'
      });
    });

    // ═══════════════════════════════════════════════════════════════════════════
    // TAB SWITCHING
    // ═══════════════════════════════════════════════════════════════════════════

    const tabIcons = document.querySelectorAll('.tab-icon');
    const tabPanels = document.querySelectorAll('.tab-panel');

    tabIcons.forEach(icon => {
      icon.addEventListener('click', () => {
        const tab = icon.dataset.tab;

        // Update active states
        tabIcons.forEach(i => i.classList.remove('active'));
        tabPanels.forEach(p => p.classList.remove('active'));

        icon.classList.add('active');
        document.querySelector(`.tab-panel[data-tab="${tab}"]`).classList.add('active');
      });
    });
  });
</script>
